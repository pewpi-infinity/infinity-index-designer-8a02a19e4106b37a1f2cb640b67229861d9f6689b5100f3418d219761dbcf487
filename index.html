<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>ğŸ›ï¸ Infinity Index Designer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Automated Index Building Machine - Build PROPER pages for every repo with token integration">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      margin: 0;
      background: #0b0b0b;
      color: #e6e6e6;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      min-height: 100vh;
    }
    
    header {
      background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
      padding: 2.5rem 2rem;
      text-align: center;
      border-bottom: 3px solid #00e5ff;
      box-shadow: 0 4px 20px rgba(0,229,255,0.2);
    }
    
    header h1 {
      font-size: 3rem;
      margin-bottom: 0.5rem;
    }
    
    header .subtitle {
      font-size: 1.2rem;
      opacity: 0.8;
      margin: 0.5rem 0;
    }
    
    header .badge {
      display: inline-block;
      background: #00e5ff;
      color: #0b0b0b;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      margin-top: 1rem;
      font-weight: bold;
      font-size: 0.9rem;
    }
    
    .dot {
      color: #00e5ff;
    }
    
    nav {
      background: rgba(26,26,26,0.95);
      padding: 1rem;
      border-bottom: 1px solid rgba(0,229,255,0.3);
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(10px);
    }
    
    nav ul {
      list-style: none;
      display: flex;
      gap: 1.5rem;
      justify-content: center;
      flex-wrap: wrap;
      max-width: 1400px;
      margin: 0 auto;
    }
    
    nav a {
      color: #00e5ff;
      text-decoration: none;
      font-weight: 600;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      transition: all 0.3s;
    }
    
    nav a:hover {
      background: rgba(0,229,255,0.1);
      transform: translateY(-2px);
    }
    
    .container {
      display: grid;
      grid-template-columns: 1fr 320px;
      gap: 2rem;
      max-width: 1400px;
      margin: 2rem auto;
      padding: 0 2rem 4rem 2rem;
    }
    
    main {
      background: rgba(26,26,26,0.8);
      padding: 2.5rem;
      border-radius: 15px;
      border: 1px solid rgba(0,229,255,0.2);
    }
    
    .hero {
      text-align: center;
      padding: 3rem 2rem;
      background: linear-gradient(135deg, rgba(0,229,255,0.1) 0%, rgba(0,229,255,0.05) 100%);
      border-radius: 15px;
      margin-bottom: 3rem;
    }
    
    .hero h2 {
      font-size: 2.5rem;
      margin-bottom: 1rem;
      color: #00e5ff;
    }
    
    .hero .animation {
      font-size: 3rem;
      margin: 1rem 0;
      animation: walk 3s infinite;
    }
    
    @keyframes walk {
      0%, 100% { transform: translateX(-30px); }
      50% { transform: translateX(30px); }
    }
    
    .search-bar {
      margin: 2rem 0;
    }
    
    .search-bar input {
      width: 100%;
      padding: 1.25rem 1.5rem;
      background: rgba(26,26,26,0.8);
      border: 2px solid rgba(0,229,255,0.3);
      border-radius: 12px;
      color: #e6e6e6;
      font-size: 1rem;
      outline: none;
      transition: all 0.3s;
    }
    
    .search-bar input:focus {
      border-color: #00e5ff;
      box-shadow: 0 0 20px rgba(0,229,255,0.2);
    }
    
    .features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin: 2rem 0;
    }
    
    .feature {
      background: rgba(26,26,26,0.6);
      padding: 2rem;
      border-radius: 12px;
      border: 1px solid rgba(0,229,255,0.2);
      transition: all 0.3s;
    }
    
    .feature:hover {
      background: rgba(0,229,255,0.05);
      border-color: #00e5ff;
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(0,229,255,0.2);
    }
    
    .feature-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }
    
    .feature h3 {
      color: #00e5ff;
      margin-bottom: 0.75rem;
      font-size: 1.3rem;
    }
    
    .feature p {
      opacity: 0.8;
      line-height: 1.6;
    }
    
    .status-online {
      color: #00ff88;
      margin-top: 0.75rem;
      font-weight: 600;
      font-size: 0.9rem;
    }
    
    aside {
      background: rgba(26,26,26,0.8);
      padding: 2rem;
      border-radius: 15px;
      border: 1px solid rgba(0,229,255,0.2);
      height: fit-content;
      position: sticky;
      top: 80px;
    }
    
    .token-widget {
      background: linear-gradient(135deg, rgba(0,229,255,0.2) 0%, rgba(0,229,255,0.1) 100%);
      padding: 1.75rem;
      border-radius: 12px;
      margin-bottom: 2rem;
      border: 1px solid rgba(0,229,255,0.3);
    }
    
    .token-widget h3 {
      color: #00e5ff;
      margin-bottom: 1rem;
      font-size: 1.2rem;
    }
    
    .token-balance {
      font-size: 2.5rem;
      font-weight: bold;
      margin: 1rem 0;
      color: #00e5ff;
    }
    
    .connections h3 {
      color: #00e5ff;
      margin-bottom: 1rem;
      font-size: 1.2rem;
    }
    
    .connection-item {
      background: rgba(0,229,255,0.05);
      padding: 1rem;
      margin: 0.75rem 0;
      border-radius: 8px;
      border-left: 3px solid #00e5ff;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.3s;
    }
    
    .connection-item:hover {
      background: rgba(0,229,255,0.1);
      transform: translateX(5px);
    }
    
    button.view-economy {
      background: #00e5ff;
      color: #0b0b0b;
      border: none;
      padding: 0.875rem 1.75rem;
      border-radius: 25px;
      cursor: pointer;
      font-weight: 700;
      width: 100%;
      font-size: 1rem;
      transition: all 0.3s;
    }
    
    button.view-economy:hover {
      background: #00b8cc;
      transform: scale(1.05);
      box-shadow: 0 6px 20px rgba(0,229,255,0.4);
    }
    
    footer {
      background: rgba(26,26,26,0.95);
      padding: 2.5rem;
      text-align: center;
      border-top: 3px solid #00e5ff;
    }
    
    .formula {
      margin: 0.75rem 0;
      font-weight: 600;
      color: #00e5ff;
      font-size: 1rem;
    }
    
    footer p {
      margin-top: 1.5rem;
      opacity: 0.8;
    }
    
    @media (max-width: 968px) {
      .container {
        grid-template-columns: 1fr;
      }
      
      header h1 {
        font-size: 2rem;
      }
      
      .hero h2 {
        font-size: 2rem;
      }
      
      nav ul {
        gap: 0.5rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>ğŸ›ï¸ Infinity Index Designer<span class="dot">.</span></h1>
    <p class="subtitle">Automated Index Building Machine</p>
    <span class="badge">âœ… PROPER PAGE - NO JUNKY PLACEHOLDERS</span>
  </header>

  <nav>
    <ul>
      <li><a href="/">ğŸ  Home</a></li>
      <li><a href="/dash-hub">ğŸª™ Token Hub</a></li>
      <li><a href="/banksy">ğŸ¨ Art Assets</a></li>
      <li><a href="/token-mint">ğŸ­ Token Mint</a></li>
      <li><a href="/pricing-engine">ğŸ’° Pricing</a></li>
      <li><a href="/facet-commerce">ğŸ›’ Commerce</a></li>
    </ul>
  </nav>

  <div class="container">
    <main>
      <div class="hero">
        <div class="animation">ğŸ„ğŸš—ğŸ„</div>
        <h2>INDEX_BUILDER Machine</h2>
        <p>Build PROPER pages for every repo - Mario walks, cars deliver!</p>
      </div>

      <div class="search-bar">
        <input type="text" id="search" placeholder="ğŸ” Find anything instantly across all repos..." />
      </div>

      <section class="features">
        <div class="feature">
          <div class="feature-icon">ğŸ›ï¸</div>
          <h3>Smart Index Builder</h3>
          <p>Automatically constructs proper repository indexes with no placeholder content</p>
          <div class="status-online">â— Active</div>
        </div>

        <div class="feature">
          <div class="feature-icon">ğŸª™</div>
          <h3>Token Integration</h3>
          <p>Earn Andy Lian Coins (ALC) for building quality pages and proper indexes</p>
          <div class="status-online">â— Active</div>
        </div>

        <div class="feature">
          <div class="feature-icon">ğŸ”—</div>
          <h3>Website Wiring</h3>
          <p>Connected via hydrogen bonds to dash-hub, banksy, token-mint, and more</p>
          <div class="status-online">â— Connected</div>
        </div>

        <div class="feature">
          <div class="feature-icon">ğŸ¨</div>
          <h3>11 Theme Support</h3>
          <p>Mario, Electronics, Token, Lab, and 7 more themes with auto-detection</p>
          <div class="status-online">â— Active</div>
        </div>

        <div class="feature">
          <div class="feature-icon">ğŸ”</div>
          <h3>Instant Search</h3>
          <p>Find anything across all connected repositories instantly</p>
          <div class="status-online">â— Active</div>
        </div>

        <div class="feature">
          <div class="feature-icon">ğŸš—</div>
          <h3>MRW Terminal</h3>
          <p>Mario walks, cars deliver indexes, mushrooms generate instantly</p>
          <div class="status-online">â— Active</div>
        </div>
      </section>
    </main>

    <aside>
      <div class="token-widget">
        <h3>ğŸª™ Andy Lian Coin</h3>
        <div class="token-balance" id="tokenBalance">0.00 ALC</div>
        <p style="opacity: 0.8; margin-bottom: 1rem;">Current Balance</p>
        <button class="view-economy" onclick="window.location.href='/dash-hub'">View Token Economy</button>
      </div>

      <div class="connections">
        <h3>ğŸ”— Connected Repos</h3>
        <div class="connection-item">
          <span>dash-hub</span>
          <span class="status-online">â— Online</span>
        </div>
        <div class="connection-item">
          <span>banksy</span>
          <span class="status-online">â— Online</span>
        </div>
        <div class="connection-item">
          <span>token-mint</span>
          <span class="status-online">â— Online</span>
        </div>
        <div class="connection-item">
          <span>pricing-engine</span>
          <span class="status-online">â— Online</span>
        </div>
        <div class="connection-item">
          <span>facet-commerce</span>
          <span class="status-online">â— Online</span>
        </div>
      </div>
    </aside>
  </div>

  <footer>
    <div class="formula">ğŸ›ï¸ INDEX_BUILDER + ğŸ§±KrisğŸ”‘ = Index Authority</div>
    <div class="formula">ğŸª¡ğŸ¤“â­ Smart weaving of content</div>
    <div class="formula">ğŸ”— Semantic linking</div>
    <p>âœ… NO junky indexes - Proper pages only!</p>
    <p style="font-size: 0.9rem; margin-top: 1rem; opacity: 0.6;">ğŸŸ¢ Luigi says: "Mamma mia! That's a proper page! ğŸ‘"</p>
  </footer>

  <script type="module">
    // Load Index Builder modules
    import AutoIndexGenerator from './builder/auto-index-generator.js';
    import ThemeDetector from './builder/theme-detector.js';
    import ContentBuilder from './builder/content-builder.js';
    import NoJunkyPages from './builder/no-junky-pages.js';
    import RepoConnector from './wiring/repo-connector.js';

    // Initialize components
    const indexGenerator = new AutoIndexGenerator();
    const repoConnector = new RepoConnector();

    // Load token balance
    async function loadTokenBalance() {
      try {
        const response = await fetch('/dash-hub/balance');
        if (response.ok) {
          const data = await response.json();
          document.getElementById('tokenBalance').textContent = data.balance + ' ALC';
        }
      } catch (err) {
        console.log('Token balance will load when dash-hub is available');
      }
    }

    // Search functionality
    document.getElementById('search').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        const query = e.target.value;
        console.log('ğŸ” Searching:', query);
        alert(`Searching for: ${query}\nCross-repo search will be available when wiring is complete.`);
      }
    });

    // Test connections on load
    repoConnector.testConnections().then(results => {
      console.log('ğŸ”— Repository wiring status:', results);
    });

    // Initialize
    loadTokenBalance();
    setInterval(loadTokenBalance, 30000); // Refresh every 30 seconds
  </script>
</body>
<!-- C13B0_CHAT_WIDGET_BEGIN -->
<style>
  .c13b0-chatfab{position:fixed;right:18px;bottom:18px;z-index:99999;border-radius:999px;padding:12px 14px;font-weight:700;box-shadow:0 10px 30px rgba(0,0,0,.25);cursor:pointer;user-select:none}
  .c13b0-chatpanel{position:fixed;right:18px;bottom:72px;width:min(520px,calc(100vw - 36px));height:min(560px,calc(100vh - 120px));z-index:99999;border-radius:18px;overflow:hidden;box-shadow:0 14px 40px rgba(0,0,0,.35);display:none}
  .c13b0-chathead{padding:10px 12px;font-weight:800;display:flex;align-items:center;justify-content:space-between}
  .c13b0-chatbody{height:calc(100% - 94px);overflow:auto;padding:10px 12px;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:13px}
  .c13b0-chatline{white-space:pre-wrap;margin:8px 0}
  .c13b0-chatbar{display:flex;gap:8px;padding:10px 12px;border-top:1px solid rgba(255,255,255,.10)}
  .c13b0-chatin{flex:1;border-radius:12px;padding:10px 12px;border:1px solid rgba(255,255,255,.12);outline:none}
  .c13b0-chatbtn{border-radius:12px;padding:10px 12px;font-weight:800;border:0;cursor:pointer}
</style>

<div id="c13b0_chat_fab" class="c13b0-chatfab">ğŸ§±ğŸ’¬ğŸ§± CHAT</div>

<div id="c13b0_chat_panel" class="c13b0-chatpanel" role="dialog" aria-label="C13B0 Chat">
  <div class="c13b0-chathead">
    <div>ğŸ§±ğŸ’¬ğŸ§± Repo Terminal</div>
    <div style="display:flex;gap:8px;align-items:center">
      <small id="c13b0_chat_repo" style="opacity:.8">repo: (auto)</small>
      <button id="c13b0_chat_close" class="c13b0-chatbtn">âœ•</button>
    </div>
  </div>
  <div id="c13b0_chat_body" class="c13b0-chatbody"></div>
  <div class="c13b0-chatbar">
    <input id="c13b0_chat_in" class="c13b0-chatin" placeholder="Ask this repo... (returns tokenized answer)" />
    <button id="c13b0_chat_send" class="c13b0-chatbtn">SEND</button>
  </div>
</div>

<script>
(function(){
  // Theme: tries to inherit page colors; keeps your design intact.
  const fab = document.getElementById("c13b0_chat_fab");
  const panel = document.getElementById("c13b0_chat_panel");
  const body = document.getElementById("c13b0_chat_body");
  const input = document.getElementById("c13b0_chat_in");
  const send = document.getElementById("c13b0_chat_send");
  const close = document.getElementById("c13b0_chat_close");
  const repoLabel = document.getElementById("c13b0_chat_repo");

  const repo = (location.pathname.split("/")[1] || "").trim(); // for org pages itâ€™s the repo root on pages
  repoLabel.textContent = "repo: " + (repo || "(root)");

  // Minimal styling decisions; avoid fighting your CSS
  fab.style.background = "rgba(0,0,0,.82)";
  fab.style.color = "white";
  panel.style.background = "rgba(0,0,0,.90)";
  panel.style.color = "white";
  document.querySelector(".c13b0-chathead").style.borderBottom = "1px solid rgba(255,255,255,.10)";
  input.style.background = "rgba(255,255,255,.06)";
  input.style.color = "white";
  send.style.background = "rgba(255,255,255,.14)";
  send.style.color = "white";
  close.style.background = "rgba(255,255,255,.14)";
  close.style.color = "white";

  function line(txt){
    const div=document.createElement("div");
    div.className="c13b0-chatline";
    div.textContent=txt;
    body.appendChild(div);
    body.scrollTop = body.scrollHeight;
  }

  function open(){ panel.style.display="block"; input.focus(); }
  function shut(){ panel.style.display="none"; }

  fab.addEventListener("click", open);
  close.addEventListener("click", shut);
  window.addEventListener("click",(e)=>{
    if(panel.style.display==="block"){
      // click outside closes
      if(!panel.contains(e.target) && e.target!==fab) shut();
    }
  });

  async function ask(){
    const q=(input.value||"").trim();
    if(!q) return;

    line("> " + q);
    input.value="";

    // Router endpoint (youâ€™ll create it in your router repo)
    // expected response: { ok:true, repo:"x", answer:"...", token:{id:"...", value:"...", type:"..."} }
    try{
      const res = await fetch("/router/ask", {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({ repo, query:q, t: Date.now() })
      });
      const data = await res.json();
      if(!data || !data.ok){
        line("âš ï¸ Router error: " + (data && data.error ? data.error : "unknown"));
        return;
      }
      if(data.answer) line(data.answer);
      if(data.token){
        line("ğŸ§±ğŸŸ¡ğŸ§± TOKEN â†’ " + JSON.stringify(data.token));
      } else {
        line("ğŸ§±ğŸ“ğŸ§± no token returned");
      }
    }catch(err){
      line("âš ï¸ fetch failed: " + err);
    }
  }

  send.addEventListener("click", ask);
  input.addEventListener("keydown",(e)=>{ if(e.key==="Enter") ask(); });
})();
</script>
<!-- C13B0_CHAT_WIDGET_END -->
</html>
